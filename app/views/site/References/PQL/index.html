<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>PQL - Developer Portal</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../iconmoon.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Developer Portal</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Back End <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Back End/Code Style Guide/">Code Style Guide</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Models/">Models</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Scripting/">Scripting</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Templates/">Templates</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Front End <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Front End/Helpers/">Helpers</a>
</li>

                        
                            
<li >
    <a href="../../Front End/Plugins/">Plugins</a>
</li>

                        
                            
<li >
    <a href="../../Front End/Themes/">Themes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Deploying/">Deploying</a>
</li>

                        
                            
<li >
    <a href="../Document Properties/">Document Properties</a>
</li>

                        
                            
<li >
    <a href="../Javadocs/">Javadocs</a>
</li>

                        
                            
<li class="active">
    <a href="./">PQL</a>
</li>

                        
                            
<li >
    <a href="../esdoc/">Esdoc</a>
</li>

                        
                            
<li >
    <a href="../tools/">Tools</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Remote <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Remote/API Explorer/">API Explorer</a>
</li>

                        
                            
<li >
    <a href="../../Remote/Browser/">Browser</a>
</li>

                        
                            
<li >
    <a href="../../Remote/DOT Net/">DOT Net</a>
</li>

                        
                            
<li >
    <a href="../../Remote/HTTP Public API/">HTTP Public API</a>
</li>

                        
                            
<li >
    <a href="../../Remote/Java/">Java</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Esign <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../esign/api/">Api</a>
</li>

                        
                            
<li >
    <a href="../../esign/development/">Development</a>
</li>

                        
                            
<li >
    <a href="../../esign/scripting/">Scripting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Workflow <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../workflow/getting-started/">Getting started</a>
</li>

                        
                            
<li >
    <a href="../../workflow/troubleshooting/">Troubleshooting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../Javadocs/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../esdoc/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#pql">PQL</a></li>
        
            <li><a href="#syntax">Syntax</a></li>
        
            <li><a href="#column-expressions">Column Expressions</a></li>
        
            <li><a href="#from-clause">FROM Clause</a></li>
        
            <li><a href="#where">WHERE</a></li>
        
            <li><a href="#order-by">ORDER BY</a></li>
        
            <li><a href="#group-by">GROUP BY</a></li>
        
            <li><a href="#virtual-data-sources">Virtual Data Sources</a></li>
        
            <li><a href="#workflowhistory">@WorkflowHistory</a></li>
        
            <li><a href="#activity">@Activity</a></li>
        
            <li><a href="#queuehistory">@QueueHistory</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="pql">PQL</h1>
<p>PQL is an SQL-like language that can be used for quering and filtering data in PaperTrail it can be used in the following places:
Anywhere where a query expression is used e.g. Advanced Search Reports, Queues, Scheduled Rules, Document linking etc..
As an alternative to groovy based expressions on node rule filters
e.g. instead of:
<code>filename == 'filename &amp;&amp; a == 'b'</code>
Use:</p>
<pre><code class="sql">WHERE filename = 'filename' AND a = 'b'
</code></pre>

<p>PQL filters are fully case-insensitive and null safe so instead of: <code>index1 != null &amp;&amp; index1.toLowerCase() == 'abc'</code><br />
Use:
<code>WHERE index1 = 'abc'</code></p>
<h2 id="syntax">Syntax</h2>
<p>The <code>SELECT</code> clause MUST contain exactly one of the following:
A comma-separated list of one or more column names (node or document index names).
You can use aliases to rename returned columns, e.g. column AS alias.
If an explicit column list is provided: Only the columns listed will be returned and only in the order supplied</p>
<p><b>*</b> : All standard indexes and any custom indexes will be returned in the default order<br />
<b>**</b> : Only custom indexes will be returned 
One or more calls to aggregate functions.
Aggregate functions produce a single row output from multiple rows in a group.</p>
<h2 id="column-expressions">Column Expressions</h2>
<p>Groovy expressions can be used to format data returned e.g. </p>
<p><code>SELECT '${name[0]}' as Initial FROM Clients</code></p>
<p>Multiple columns can also be referenced:
<code>SELECT '${LastName}, ${FirstName}' as FullName FROM Clients</code> </p>
<p>As well as arithmetic on Number and Double indexes:
<code>SELECT '${total + vat}' as GrandTotal FROM 'Sales'</code></p>
<h2 id="from-clause">FROM Clause</h2>
<p>The FROM clause identifies which Virtual Table (Node) the query will be run against, as described in the previous section.</p>
<p>The FROM clause MUST contain the full path of a node, and MUST be single quoted if there are any spaces .e.g</p>
<p><code>FROM parent/division</code>
<code>FROM 'parent/sub folder/folder'</code></p>
<h2 id="where">WHERE</h2>
<p>This clause identifies the constraints that rows MUST satisfy to be considered a result for the query.</p>
<p>All column names MUST be valid “queryName” or their aliased values for properties that are defined as “queryable” in the Object-Type(s) whose Virtual Tables are listed in the FROM clause.</p>
<p>Properties are defined to not support a “null” value, therefore the <null predicate> MUST be interpreted as testing the not set or set state of the specified property.</p>
<p>Comparisons permitted in the WHERE clause.</p>
<p>PQL supports the following predicates:</p>
<ul>
<li>= (equals)  </li>
<li>> (bigger than, after)  </li>
<li>&lt; (smaller than, before)  </li>
</ul>
<blockquote>
<p>Note: Bigger than / Less than and end equal to (&gt;=, &lt;=) are not supported</p>
</blockquote>
<ul>
<li>contains</li>
<li>startsWith</li>
<li>
<p>endWith
BETWEEN and NOT BETWEEN predicates to compare on ranges
e.g. column BETWEEN a AND b, is equivalent to column &gt;= a AND column &lt;= b </p>
</li>
<li>
<p>IN  </p>
</li>
<li>LIKE   </li>
<li>IS NULL  </li>
<li>IS NOT NULL  </li>
<li>all_empty  <blockquote>
<p>e.g. a filter that matches when all 4 indexes are populated
WHERE not all_empty (invoice_no,total,date,approved)</p>
</blockquote>
</li>
<li>not all_empty  </li>
<li>before, after <br />
WHERE createdDate BEFORE '2015-01-01'  </li>
</ul>
<h3 id="where-expressions">WHERE Expressions</h3>
<p>Expressions can also be used within WHERE clauses. e.g.</p>
<p><code>SELECT name FROM Customers WHERE '${name[0]}' = 'A'</code></p>
<h2 id="order-by">ORDER BY</h2>
<p>This clause MUST a single column to order by
All column names referenced in this clause MUST be valid “queryName” or alias (either for an aggregate function result or a column).
Only columns in the SELECT clause MAY be in the ORDER BY clause.</p>
<h2 id="group-by">GROUP BY</h2>
<p>This clause specifies one or many columns to group by.</p>
<p>Supported functions:</p>
<ul>
<li><strong>COUNT(column)</strong>, <strong>COUNT(*)</strong> - returns a number of entries in a group. COUNT(column) skips null values.</li>
<li><strong>AVG(column)</strong> - returns an average value of a column in a group.</li>
<li><strong>MIN(column)</strong>, <strong>MAX(column)</strong> - return a minimal or maximal value of a certain column in a group.</li>
<li><strong>SUM(column)</strong> - returns a sum of a column in a group.
Escaping</li>
</ul>
<p>Repositories MUST support the escaping of characters using a backslash () in the query statement.  The backslash character () will be used to escape characters within quoted strings in the query as follows:</p>
<p>\’ will represent a single-quote(‘) character
\ \ will represent a backslash () character
Within a LIKE string, \% and _ will represent the literal characters % and _, respectively.
All other instances of a \ are errors.</p>
<h2 id="virtual-data-sources">Virtual Data Sources</h2>
<p><code>FROM '@{VirtualDataSource}</code></p>
<h2 id="workflowhistory">@WorkflowHistory</h2>
<p>The workflow history virtual data source will return details about the unassigned and human tasks of a one or more documents e.g. </p>
<pre><code class="sql">SELECT * FROM '@WorkflowHistory' WHERE docId = 1
</code></pre>

<p>Will return the following special columns:</p>
<p>allocation:
    The final user allocated<br />
createdBy:
    Who the allocation was created by, Not the creator of the document<br />
position:
    The workflow label of the task<br />
duration:
    The duration of the task e.g. 12 hours<br />
businessDuration:
    The duration of the task while in business hours e.g. 2 hours<br />
start: 
    The start date of the task<br />
end :
    The end date of the task<br />
durationMillis:
    The duration of the task in milliseconds  </p>
<p>Any standard and custom indexes can also be merged into the results by adding them into the column list.
Any standard search criteria can also be used</p>
<h2 id="activity">@Activity</h2>
<h2 id="queuehistory">@QueueHistory</h2></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2016 Egis Software</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
