<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Scripting - Developer Portal</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../iconmoon.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Developer Portal</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Back End <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Back End/Code Style Guide/">Code Style Guide</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Models/">Models</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Scripting/">Scripting</a>
</li>

                        
                            
<li >
    <a href="../../Back End/Templates/">Templates</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Front End <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Front End/Helpers/">Helpers</a>
</li>

                        
                            
<li >
    <a href="../../Front End/Plugins/">Plugins</a>
</li>

                        
                            
<li >
    <a href="../../Front End/Themes/">Themes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">References <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../References/Deploying/">Deploying</a>
</li>

                        
                            
<li >
    <a href="../../References/Document Properties/">Document Properties</a>
</li>

                        
                            
<li >
    <a href="../../References/Javadocs/">Javadocs</a>
</li>

                        
                            
<li >
    <a href="../../References/PQL/">PQL</a>
</li>

                        
                            
<li >
    <a href="../../References/esdoc/">Esdoc</a>
</li>

                        
                            
<li >
    <a href="../../References/tools/">Tools</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Remote <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Remote/API Explorer/">API Explorer</a>
</li>

                        
                            
<li >
    <a href="../../Remote/Browser/">Browser</a>
</li>

                        
                            
<li >
    <a href="../../Remote/DOT Net/">DOT Net</a>
</li>

                        
                            
<li >
    <a href="../../Remote/HTTP Public API/">HTTP Public API</a>
</li>

                        
                            
<li >
    <a href="../../Remote/Java/">Java</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Esign <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">Api</a>
</li>

                        
                            
<li >
    <a href="../development/">Development</a>
</li>

                        
                            
<li class="active">
    <a href="./">Scripting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Workflow <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../workflow/getting-started/">Getting started</a>
</li>

                        
                            
<li >
    <a href="../../workflow/troubleshooting/">Troubleshooting</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../development/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../workflow/getting-started/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#esign-scripting">eSign Scripting</a></li>
        
            <li><a href="#field-level">Field Level</a></li>
        
            <li><a href="#validations">Validations</a></li>
        
            <li><a href="#populating-values">Populating values</a></li>
        
            <li><a href="#field-binding">Field Binding</a></li>
        
            <li><a href="#form-validations">Form Validations</a></li>
        
            <li><a href="#global-functions">Global Functions</a></li>
        
            <li><a href="#multiple-signers">Multiple Signers</a></li>
        
            <li><a href="#accessing-previously-submitted-values">Accessing Previously Submitted Values</a></li>
        
            <li><a href="#duplicate-fields">Duplicate Fields</a></li>
        
            <li><a href="#radio-buttons">Radio Buttons</a></li>
        
            <li><a href="#lookup-fields">Lookup Fields</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="esign-scripting">eSign Scripting</h1>
<p>eSign forms are scriptable at 3 different levels:</p>
<ol>
<li>Field Level - Accessible by <span class="menu">right clicking</span> on a field and selecting <span class="menu">Scripts</span></li>
<li>Form Validations - Accessible by clicking on the <span class="menu">cog</span> in the top right and selecting <span class="menu">Form Properties</span></li>
<li>Server Side <ul>
<li>Event based via Node Rules and Workflows</li>
<li>Data Source based</li>
</ul>
</li>
</ol>
<h2 id="field-level">Field Level</h2>
<p>The custom field level scripts are applied to the underlying EgisUI field component e.g. apply(field, custom), this means any functionality available in EgisUI is available on a field level.  </p>
<p>The scripts applied to fields must be valid Javascript (ES5) Objects = i.e. begin with { and and with <var>}</var></p>
<h2 id="validations">Validations</h2>
<p>Add a required validation for a number between 1 and 10:</p>
<p><code>{  
 validations: "required number(1,10)"  
}</code></p>
<p>Validations are created by specifying a validation string or a validation function on a property via the Right click -&gt; Scripts dialog.  </p>
<pre><code class="javascript">{  
   validations: &quot;number(1,10)&quot;  
}
</code></pre>

<p>Adds a required validation for a number between 1 and 10</p>
<h3 id="validation-format">Validation Format</h3>
<table border="1" cellpadding="1" cellspacing="1" style="width: 100%;">

<thead>

<tr>

<th scope="col">Validator</th>

<th scope="col">Example </th>

<th scope="col">Description</th>

</tr>

</thead>

<tbody>

<tr>

<td>required</td>

<td>Ensure that a field is completed with non empty string</td>
<td>&nbsp;</td>

</tr>

<tr>

<td>number(min,max)</td>

<td>number  
number(1)  
number(1,2)</td>

<td>Ensures that a value is valid number and/or between min and max</td>

</tr>

<tr>

<td>length(min,max)</td>

<td><span style="line-height: 20.8px;">length(1)</span>  
<span style="line-height: 20.8px;">length(1,2)</span></td>

<td>Ensures that at least min and at most max chars are specified</td>

</tr>

<tr>

<td>South African ID</td>

<td><span style="line-height: 20.8px;">SouthAfricanID</span></td>

<td>Ensures that the value entered is valid south african ID using the checksum validation    </td>

</tr>

<tr>

<td>Capitalize</td>

<td>Capitalize</td>

<td>Ensures that the first letter is capitalized e.g. John smith is valid, but john smith is not</td>

</tr>

<tr>

<td>Capitalize ALL</td>

<td>CapitalizeAll</td>

<td>Ensures all words are capitalized, John Smith is valid, but John smithis not</td>

</tr>

<tr>

<td>email</td>
<td>&nbsp;</td>
<td>&nbsp;</td>


</tr>

<tr>

<td>date</td>
<td>&nbsp;</td>
<td>&nbsp;</td>


</tr>

<tr>

<td>datetime</td>
<td>&nbsp;</td>
<td>&nbsp;</td>



<tr>

<td>future</td>
<td>&nbsp;</td>
<td>&nbsp;</td>


</tr>

<tr>

<td>past</td>
<td>&nbsp;</td>
<td>&nbsp;</td>


</tr>

<tr>

<td>password</td>
<td>&nbsp;</td>
<td>&nbsp;</td>


</tr>

<tr>

<td>ip</td>
<td>&nbsp;</td>
<td>&nbsp;</td>

</tr>

<tr>

<td><span style="line-height: 20.8px;">url</span></td>
<td>&nbsp;</td>
<td>&nbsp;</td>

</tr>

</tbody>

</table>

<h3 id="custom-validations">Custom Validations</h3>
<pre><code class="javascript">{  
    validator() {  
       if (this.value = 'password') {  
           return &quot;Cannot specify 'password' as a password';       
       }   
       // no return or null return indicates a validation pass  
   }  
}
</code></pre>

<h3 id="async-validation">Async Validation</h3>
<pre><code class="javascript">{
    type: 'hidden',
    alwaysValidate: false, // hidden fields are not normally validated
    validate: function() {
        var form = this.field.form;
        var field = this.field;
        if (!form.IDNumber.valid) {
            // dont sent network request if not necessary
            return &quot;&quot;;
        }

        //return a promise for async validators
        return new Promise(function(resolve) {
            HTTP.get('/data/3rd_party?id=' + form.IDNumber.value).then( function(result) {

                if (result.valid) {
                    //resolve with nothing is validation pass
                    resolve(&quot;&quot;); 
                } else {
                    //resolve with an error message to show the user
                    resolve(result.validation_error);
                }
            })
        });
}
</code></pre>

<h2 id="populating-values">Populating values</h2>
<p>Populate all matching fields based on data returned by a data source:         </p>
<pre><code class="javascript">{  
 onChange: function() {  
        this.form.values = this.data;  
    }  
}
</code></pre>

<p>Configure a default value:</p>
<pre><code class="javscript">{  
 value: 'one123'  
}
</code></pre>

<h3 id="field-properties">Field Properties</h3>
<table border="1" cellpadding="1" cellspacing="1" style="width: 500px;">

<thead>

<tr>

<th>Reference</th>

<th>Description</th>

</tr>
</thead>

<tbody>
<tr>

<td>this</td>

<td><span style="line-height: 20.8px;">reference to the EgisUI field</span></td>

</tr>

<tr>

<td>this.form</td>

<td><span style="line-height: 20.8px;">a reference to the EgisUI form</span></td>

</tr>

<tr>

<td><span style="line-height: 20.8px;">this.form.values</span></td>

<td><span style="line-height: 20.8px;">A map of all </span>field name and values entered in the form  
Can also be used to set other fields en mass by assigning it a map</td>

</tr>

<tr>

<td>this.data</td>

<td><span style="line-height: 20.8px;"> In a </span> datasource <span style="line-height: 20.8px;"> lookup field all of the data returned by the </span> datasource</td>

</tr>

</tbody>

</table>

<p>See <a href="https://s3.amazonaws.com/papertrail/libs/egis-ui/class/src/fields/AbstractField.js~Field.html">Field</a> and <a href="https://s3.amazonaws.com/papertrail/libs/egis-ui/class/src/ui/Form.js~Form.html">Form</a> for a more complete list.</p>
<h3 id="field-properties_1">Field Properties</h3>
<p>Field properties are accessible in listeners  </p>
<table border="1" cellpadding="1" cellspacing="1" style="width: 500px;">

<thead>

<tr>

<th scope="col">Property</th>

<th scope="col">Description</th>

</tr>

</thead>

<tbody>

<tr>

<td><var>hidden</var></td>

<td>hide from the user, but do not return in form.values and submissions</td>

</tr>

<tr>

<td><var>disabled</var></td>

<td>disabled fields are not returned in form.values</td>

</tr>

<tr>

<td><var>value</var></td>
<td>&nbsp;</td>

</tr>

<tr>

<td><var>valid</var></td>

<td>hidden and disabled fields are always valid</td>

</tr>

<tr>

<td><var>invalid</var></td>

<td>The invalid error message to show the user</td>

</tr>

<tr>

<td><var>help</var></td>

<td>A help message to show below / as tooltip </td>

</tr>

<tr>

<td><var>label</var>       </td>

<td>Allows changing the label of a field dynamically</td>

</tr>

<tr>

<td><var>el</var></td>

<td>The underlying  HTML DOM element</td>

</tr>

<tr>

<td><var>_container</var></td>

<td>The underlying HTML DOM element that contains the label, messages and el</td>

</tr>

</tbody>

</table>

<h2 id="field-binding">Field Binding</h2>
<p>Field properties can be bound to others fields values, e.g. to hide field a when field b is checked:</p>
<pre><code class="javascript">{  
    bind: {  
        hidden: &quot;fieldb == 'true'&quot;  
    }  
}
</code></pre>

<p>If a field will be disabled, the following format should be used:</p>
<pre><code class="javascript">{ 
    bind: { 
        hidden: &quot;form.fieldb.value == 'true'&quot; 
    } 
}
</code></pre>

<h2 id="form-validations">Form Validations</h2>
<p>All field values are available directly <br />
<code>if (text1 != "123")</code><br />
<span style="font-family: sans-serif, Arial, Verdana, 'Trebuchet MS'; line-height: 1.6;">Or indirectly:</span><br />
<code>if (form.text1.value)</code></p>
<h2 id="global-functions">Global Functions</h2>
<p>To add a global function that can be used in multiple field handlers, in the <span class="menu">Form Properties -&gt; Initialization Script</span> field add the function:  </p>
<pre><code class="javascript">window.helloWorld = function(field) {  
    return field.value + &quot; world&quot;;  
}
</code></pre>

<p>which can then be used in a field script:  </p>
<pre><code>{  
    onChange: function() {  
       this.form.hello = helloWorld(this);   
    }  
}
</code></pre>

<h2 id="multiple-signers">Multiple Signers</h2>
<p>To have multiple people sign the same document add 2 or more signatures fields.  </p>
<p>You must specify a name and email - If it is unknown at the time of design, then you can use a placeholder role e.g. <var>{Manager}</var><br />
To assign the role to a specific person use the following script:  </p>
<pre><code class="java">doc.signature().assignRole('{Manager}', 'John Smith')`  
</code></pre>

<p>You can also create a new user on demand from values within the form:</p>
<pre><code class="java">import com.egis.kernel.Kernel;
import com.egis.security.TokenService;


def session = doc.session;
def tokens = Kernel.get(TokenService.class);

//retrieved values from the saved form
def form = doc.signature().getSavedValues();

def user = tokens.getOrCreateShareUser(form.email, form.name)

doc.signature().assignRole('{Manager}', user.name)

//send will automatically assign permissions if they are a share user 
doc.signature().send();

//otherwise you need to add permissions explicitly
//doc.security().addRole(user, &quot;SIGN&quot;)


</code></pre>

<p>To restrict which fields are editable by which users select the <strong>Restrict To</strong> option in the fields properties window.  </p>
<h2 id="accessing-previously-submitted-values">Accessing Previously Submitted Values</h2>
<p>Any field that was completed and printed to the PDF will still be available in scripts as a hidden read-only field.  </p>
<h2 id="duplicate-fields">Duplicate Fields</h2>
<p>You can also duplicate fields field specifying the same name but different Restrict To - Only the relevant fields will be shown to the users.<br />
If a value has already been completed e.g. in a Submit and Approve/Amend scenario then the previous value will pre-populated the duplicated value.  </p>
<p><code>this[name]</code> and <code>this.values</code> will return the current field values - to access the old field values manually filter the fields list:  </p>
<pre><code class="javascript">this.fields.find(function(fld) {  
  return fld.name == 'original value' &amp;&amp; fld.options.hidden;  
});
</code></pre>

<h2 id="radio-buttons">Radio Buttons</h2>
<p>To combine radio buttons into a group, give all the fields the same field <code>id</code>. The <code>label</code> of the field will be used as value.</p>
<p>To access the individual radios in a group: <code>radio1.fields[0].hide()</code></p>
<p>Disabled, hidden and required will all works as expected.</p>
<p>The required indicator will be shown on the first field with <code>required = true</code></p>
<h2 id="lookup-fields">Lookup Fields</h2>
<h4 id="update-a-form-with-all-values-returned-from-a-lookup">Update a form with all values returned from a lookup:</h4>
<pre><code class="javascript">{
  onChange: function() {  
   this.form.values = this.data  
  }  
}
</code></pre>

<p><strong>Where:</strong></p>
<p><code>this.form.values</code>is an property setter to set all the values on the form<br />
<code>this.data</code> is an object of the currently selected lookup item</p>
<h4 id="updating-a-lookup-field-dynamically">Updating a lookup field dynamically:</h4>
<pre><code class="javascript">combo.update([{value:1,description: 'one'},{value:2,description:'two'}])
</code></pre>

<h4 id="parent-child-lookup-fields">Parent Child lookup fields:</h4>
<p>On the source lookup field use the following script:</p>
<pre><code class="javascript">{  
  onChange: function() {  
    var id = this.data.get('userId');  
    if (id != null) {  
        var lookup3 = this.form.lookup3;  
        get('/data/{data source name}?filter=' + id, function(items) {  
           lookup3.update(items)  
        });  
    }  
  }         
}        
</code></pre>

<p><strong>Where:</strong></p>
<p><code>this.data</code> is an object of the currently selected lookup item<br />
<code>this.data.get</code> is a method to retrieve an item from the data object without case sensisitivyt (normal case sensitive his.data.userid can still be used) <br />
<code>lookup3</code> is any Lookup field, A Dynamic List can be used for lookups that render empty  and can only be populated by scripts<br />
<code>/data/</code> is the path to the data source lookup service<br />
<code>{data source name}</code> is the name of data source config under Services -&gt; Data Sources<br />
<code>filter</code> maps to the <span style="line-height: 20.8px;"><code>${filter}</code> parameter in the above data source</span></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2016 Egis Software</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../extra.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
